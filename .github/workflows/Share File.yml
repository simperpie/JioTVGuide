name: Share File

on:
  push:
    branches:
      - main  # adjust as needed

jobs:
  push_file:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout private repository
      uses: actions/checkout@v2
      with:
        repository: simperpie/tempest
        token: ${{ secrets.PUBLIC_REPO_TOKEN }}
    
    - name: Copy file to public repo
      run: |
         cp tempest_config/epg/tvguide.xml.gz /tmp/update-repo
        # You might need to add additional setup here depending on your file structure

    - name: Clone or pull public repo
      run: |
        if [ -d "/tmp/update-repo/.git" ]; then
          cd /tmp/update-repo
          git pull origin main
        else
          rm -rf /tmp/update-repo
          git clone https://github.com/simperpie/update /tmp/update-repo
        fi

    - name: Add file to Git index
      run: |
        cd /tmp/update-repo
        git add tvguide.xml.gz
        
    - name: Commit and push changes
      run: |
        cd /tmp/update-repo
        git config user.name "GitHub Action"
        git config user.email "action@github.com"
        git add .
        git commit -m "Update file from private repo"
        git push origin main  # adjust the branch name as needed
